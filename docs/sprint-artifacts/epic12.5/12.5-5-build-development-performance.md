# Story 12.5-5: Build & Development Performance

| Field | Value |
|-------|-------|
| **Story ID** | 12.5-5 |
| **Epic** | Epic 12.5: Performance Optimization |
| **Title** | Build & Development Performance |
| **Status** | drafted |
| **Priority** | P2 (Medium - Can Defer) |
| **Points** | 3 |
| **Sprint** | Pending |

## User Story

**As a** developer,
**I want** faster build and development cycles,
**So that** I can iterate quickly during development.

## Problem Statement

Slow build times and hot reload can significantly impact developer productivity. This story evaluates and potentially improves:
- npm install times
- Production build times
- Development server startup
- Hot reload speed

**IMPORTANT:** This does NOT affect user-facing performance. Package managers (npm, pnpm, Bun) only affect install/build time, not runtime performance. This story is lower priority than Stories 12.5.2-12.5.4.

## Acceptance Criteria

### AC12.5.5.1: Build Time Baseline

- [ ] Document current production build time (`npm run build`)
- [ ] Document current npm install time (clean install)
- [ ] Document dev server startup time (`npm run dev`)
- [ ] Document hot reload time (average file change)

### AC12.5.5.2: Dev Server Optimization

- [ ] Review hot reload performance
- [ ] Identify slow hot reloads (if any)
- [ ] Fix configuration issues affecting dev performance
- [ ] Document dev server improvements

### AC12.5.5.3: Package Manager Evaluation

- [ ] Document current npm install time (clean, with lockfile)
- [ ] Evaluate pnpm as alternative:
  - Install time comparison
  - Disk space usage
  - Compatibility check
- [ ] Evaluate Bun as alternative:
  - Install time comparison
  - Build time comparison (if using Bun for build)
  - Compatibility check
- [ ] **Implement only if > 2x faster** and no compatibility issues
- [ ] Document decision with rationale

### AC12.5.5.4: Documentation

- [ ] Document final build/dev times
- [ ] Document package manager decision
- [ ] Add any new npm scripts if tools changed

## Tasks/Subtasks

### Task 1: Baseline Measurements
- [ ] 1.1 Clean npm install time (`rm -rf node_modules && npm ci`)
- [ ] 1.2 Production build time (`npm run build`)
- [ ] 1.3 Dev server startup (`npm run dev`)
- [ ] 1.4 Hot reload time (average of 5 file changes)

### Task 2: Dev Server Review
- [ ] 2.1 Check for slow hot reloads
- [ ] 2.2 Review next.config.js for issues
- [ ] 2.3 Check TypeScript config for dev impact
- [ ] 2.4 Fix any identified issues

### Task 3: Package Manager Evaluation
- [ ] 3.1 Test pnpm install time
- [ ] 3.2 Test Bun install time
- [ ] 3.3 Compare results
- [ ] 3.4 Check compatibility (run E2E tests)
- [ ] 3.5 Document findings

### Task 4: Implementation (if warranted)
- [ ] 4.1 Migrate to chosen package manager (if different)
- [ ] 4.2 Update CI/CD configuration
- [ ] 4.3 Update documentation
- [ ] 4.4 Verify all scripts work

### Task 5: Documentation
- [ ] 5.1 Document final metrics
- [ ] 5.2 Document decision rationale
- [ ] 5.3 Update README if package manager changed

## Technical Notes

### Package Manager Comparison Commands

```bash
# npm (current)
rm -rf node_modules package-lock.json
time npm install

# pnpm
rm -rf node_modules pnpm-lock.yaml
time pnpm install

# Bun
rm -rf node_modules bun.lockb
time bun install
```

### Expected Improvements

| Tool | Install Speed | Notes |
|------|---------------|-------|
| npm | Baseline | Current |
| pnpm | ~2-3x faster | Uses hard links, saves disk |
| Bun | ~5-10x faster | Written in Zig, very fast |

### Compatibility Considerations

**pnpm:**
- Works with most npm packages
- May need `shamefully-hoist=true` for some packages
- Different lockfile format

**Bun:**
- Still maturing, some compatibility gaps
- May not work with all npm scripts
- Requires Bun runtime installed

### Build Optimization (if needed)

```javascript
// next.config.js - skip type checking in build (faster, but risky)
// Only if TypeScript errors are caught in CI separately
module.exports = {
  typescript: {
    ignoreBuildErrors: true,
  },
};
```

### Hot Reload Issues to Check

- Large files in `app/` directory
- Circular imports
- Heavy middleware
- Many dynamic routes

## Definition of Done

- [ ] Build time baseline documented
- [ ] Dev server reviewed and optimized
- [ ] Package manager evaluated (pnpm, Bun)
- [ ] Decision documented with rationale
- [ ] If changed: CI/CD updated, docs updated
- [ ] All tests pass with final configuration

## Dependencies

- **Prerequisites:** Story 12.5.1 (context)
- **Blocks:** Story 12.5.6 (validation)
- **Can Parallel:** Stories 12.5.2, 12.5.3, 12.5.4
- **Can Defer:** This story can be skipped if time-constrained

## Risks

| Risk | Mitigation |
|------|------------|
| Package manager breaks builds | Test thoroughly before switching |
| CI/CD compatibility issues | Test in CI before merging |
| Bun immaturity | Stick with pnpm if Bun has issues |

## Notes

This story is **P2 (lower priority)** because:
1. It only affects developer experience, not users
2. Current npm performance may be acceptable
3. Switching package managers has migration risk

Consider deferring if time-constrained. The user-facing optimizations (12.5.2, 12.5.3, 12.5.4) should take priority.

---

_Story created 2025-12-28_
