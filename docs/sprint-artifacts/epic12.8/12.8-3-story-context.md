# Story 12.8-3: Provider "Mis Ofertas" Fix - Context

## Quick Reference

| Field | Value |
|-------|-------|
| **Story** | 12.8-3: Provider "Mis Ofertas" Fix |
| **Priority** | P2 (Medium) |
| **Points** | 5 |
| **Bugs** | BUG-R2-009, BUG-R2-018 |

## Problem Summary

1. Completed deliveries still show in "Mis Ofertas"
2. Status displays "Aceptada" even for delivered orders
3. Default filter is pre-selected, hiding offers

## Root Cause

Using `offers.status` instead of `water_requests.status`:
- `offers.status` = 'accepted' (never changes)
- `water_requests.status` = 'delivered', 'in_transit', etc. (actual state)

## Key Files

| File | Purpose |
|------|---------|
| `src/app/provider/offers/page.tsx` | Remove default filter |
| `src/lib/actions/offers.ts` | Filter out delivered/cancelled |
| `src/components/provider/offer-card.tsx` | Display `request.status` |

## Implementation Steps

1. Update offers query to filter by `water_requests.status`
2. Exclude `delivered` and `cancelled` from active list
3. Update card to display `request.status` not `offers.status`
4. Remove default filter on page load

## Query Fix

```sql
-- Add this filter to offers query:
.not("request.status", "in", "(delivered,cancelled)")
```

## Status Display Fix

```typescript
// Use water_requests.status for display
const displayStatus = offer.request?.status || offer.status;
```

## Testing Focus

- Complete a delivery â†’ disappears from "Mis Ofertas"
- Active delivery shows "En Camino" not "Aceptada"
- No default filter on page load
