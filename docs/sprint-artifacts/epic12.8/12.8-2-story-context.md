# Story 12.8-2: Role-Based Route Guards - Context

## Quick Reference

| Field | Value |
|-------|-------|
| **Story** | 12.8-2: Role-Based Route Guards |
| **Priority** | P0 (Critical - Security) |
| **Points** | 5 |
| **Bugs** | BUG-R2-004 |

## Problem Summary

Admin users can access consumer views by navigating to consumer routes. No role verification prevents cross-role access.

## Root Cause

Consumer routes (`/settings`, `/request`, `/consumer-profile`) only check "is authenticated" but NOT "has correct role".

## Key Files

| File | Purpose |
|------|---------|
| `src/middleware.ts` | Add role-based route guards (recommended) |
| `src/app/(consumer)/layout.tsx` | Add role check, redirect if wrong |
| `src/app/provider/layout.tsx` | Verify role check exists |
| `src/app/admin/layout.tsx` | Verify role check exists |
| `src/lib/auth/role-redirect.ts` | **CREATE** - Helper function |

## Route Protection Matrix

| Route Pattern | Required Role | Action if Wrong |
|--------------|---------------|-----------------|
| `/admin/*` | admin | Redirect to `/provider` or `/` |
| `/provider/*` | supplier | Redirect to `/admin` or `/` |
| `/settings`, `/request`, `/consumer-profile` | consumer | Redirect to `/admin` or `/provider` |

## Implementation Steps

1. Create role redirect helper utility
2. Add middleware guards for all route categories
3. Add layout-level guards as backup
4. Test cross-role navigation attempts

## Testing Focus

- Admin → /settings → redirected to /admin
- Provider → /admin → redirected to /provider
- Consumer → /provider → redirected to /
- Unauthenticated → any protected route → /login

## Security Impact

**CRITICAL** - Fixes role isolation failure. Prevents admins from accidentally seeing consumer UI.
