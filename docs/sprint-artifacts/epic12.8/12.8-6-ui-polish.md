# Story 12.8-6: UI Polish (Toasts, Icons, Fonts)

| Field | Value |
|-------|-------|
| **Story ID** | 12.8-6 |
| **Epic** | Epic 12.8: Round 2 Manual Testing Bug Fixes |
| **Title** | UI Polish (Toasts, Icons, Fonts) |
| **Status** | backlog |
| **Priority** | P3 (Low) |
| **Points** | 3 |
| **Bug References** | BUG-R2-005, BUG-R2-006, BUG-R2-016 |

## User Story

**As a** user of the NitoAgua PWA,
**I want** consistent fonts, proper notification icons, and polished toast messages,
**So that** my experience feels professional and complete.

## Problem Statement

Three visual polish issues were identified during testing:

### BUG-R2-005: Push Notification Status Bar Icon Grey Circle
When a push notification arrives on Android, the small icon in the status bar appears as a grey/white circle instead of the NitoAgua app icon.

### BUG-R2-006: Rating Popup Font Inconsistency
The rating popup that appears after delivery completion may have inconsistent font styling compared to the rest of the app. (Needs verification)

### BUG-R2-016: Toast Notifications Font & Icons
Toast notifications have visual issues:
1. Font doesn't match app font (Inter)
2. Toast messages lack icons for success/error states

## Technical Context

### Files to Modify

| File | Current Issue | Required Change |
|------|--------------|-----------------|
| `public/sw.js` | No badge icon in notification | Add badge property |
| `public/icons/` | Missing monochrome badge icon | Add badge-72.png |
| `src/app/manifest.ts` | May not specify all icons | Verify icon config |
| `src/components/ui/sonner.tsx` | No font config, no icons | Add font + icon config |
| Rating dialog component | Font may differ | Ensure font-sans class |

## Acceptance Criteria

### AC12.8.6.1: Notification Status Bar Icon
**Given** an Android device with NitoAgua installed
**When** a push notification arrives
**Then** the status bar shows a recognizable NitoAgua icon
**And** the icon is monochrome (white on transparent)
**And** the icon is identifiable at small sizes

### AC12.8.6.2: Notification Expanded Icon
**Given** a push notification in the notification shade
**When** viewed by the user
**Then** the full-color NitoAgua icon is displayed
**And** the icon is crisp and properly sized (192x192)

### AC12.8.6.3: Toast Font Consistency
**Given** any toast notification in the app
**When** displayed
**Then** the font matches the app's primary font (Inter)
**And** font weight and size are consistent with design system

### AC12.8.6.4: Toast Success Icons
**Given** a success toast (e.g., "¡Pedido enviado!")
**When** displayed
**Then** a green checkmark icon is visible
**And** the icon is aligned with the text

### AC12.8.6.5: Toast Error Icons
**Given** an error toast (e.g., "Error al enviar")
**When** displayed
**Then** a red X or warning icon is visible
**And** the icon clearly indicates error state

### AC12.8.6.6: Rating Popup Font
**Given** the rating popup after delivery
**When** displayed to the consumer
**Then** all text uses the app's standard font
**And** no jarring font differences are visible

## Implementation

### Step 1: Create Monochrome Badge Icon

Create a 72x72px monochrome icon for Android status bar:

```
public/icons/badge-72.png
- 72x72 pixels
- White foreground on transparent background
- Simple droplet silhouette (recognizable at small size)
- No color - Android will tint it
```

Design spec:
- Use the existing droplet logo
- Make it solid white
- Transparent background
- Centered in 72x72 canvas
- Leave ~10% padding around edges

### Step 2: Update Service Worker Notification

```javascript
// public/sw.js

self.addEventListener("push", function (event) {
  const data = event.data?.json() || {};

  const options = {
    body: data.body || "Tienes una nueva notificación",
    icon: "/icons/icon-192.png",        // Full color icon (notification shade)
    badge: "/icons/badge-72.png",        // Monochrome icon (status bar)
    tag: data.tag || "default",
    data: {
      url: data.url || "/",
    },
    vibrate: [100, 50, 100],
    requireInteraction: data.requireInteraction || false,
  };

  event.waitUntil(
    self.registration.showNotification(
      data.title || "NitoAgua",
      options
    )
  );
});
```

### Step 3: Update Manifest Icons

```typescript
// src/app/manifest.ts

import type { MetadataRoute } from "next";

export default function manifest(): MetadataRoute.Manifest {
  return {
    name: "NitoAgua",
    short_name: "NitoAgua",
    description: "Delivery de agua potable",
    start_url: "/",
    display: "standalone",
    background_color: "#ffffff",
    theme_color: "#0077B6",
    icons: [
      {
        src: "/icons/icon-72.png",
        sizes: "72x72",
        type: "image/png",
      },
      {
        src: "/icons/icon-96.png",
        sizes: "96x96",
        type: "image/png",
      },
      {
        src: "/icons/icon-128.png",
        sizes: "128x128",
        type: "image/png",
      },
      {
        src: "/icons/icon-144.png",
        sizes: "144x144",
        type: "image/png",
      },
      {
        src: "/icons/icon-152.png",
        sizes: "152x152",
        type: "image/png",
      },
      {
        src: "/icons/icon-192.png",
        sizes: "192x192",
        type: "image/png",
        purpose: "any maskable",
      },
      {
        src: "/icons/icon-384.png",
        sizes: "384x384",
        type: "image/png",
      },
      {
        src: "/icons/icon-512.png",
        sizes: "512x512",
        type: "image/png",
      },
    ],
  };
}
```

### Step 4: Configure Sonner Toast Styling

```tsx
// src/components/ui/sonner.tsx

import { Toaster as Sonner } from "sonner";
import { CheckCircle, XCircle, AlertCircle, Info } from "lucide-react";

type ToasterProps = React.ComponentProps<typeof Sonner>;

const Toaster = ({ ...props }: ToasterProps) => {
  return (
    <Sonner
      className="toaster group"
      toastOptions={{
        style: {
          fontFamily: 'Inter, system-ui, -apple-system, sans-serif',
        },
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-white group-[.toaster]:text-gray-900 group-[.toaster]:border-gray-200 group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-gray-500",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
          success:
            "group-[.toaster]:bg-green-50 group-[.toaster]:border-green-200",
          error:
            "group-[.toaster]:bg-red-50 group-[.toaster]:border-red-200",
          warning:
            "group-[.toaster]:bg-amber-50 group-[.toaster]:border-amber-200",
          info:
            "group-[.toaster]:bg-blue-50 group-[.toaster]:border-blue-200",
        },
      }}
      icons={{
        success: <CheckCircle className="h-5 w-5 text-green-500" />,
        error: <XCircle className="h-5 w-5 text-red-500" />,
        warning: <AlertCircle className="h-5 w-5 text-amber-500" />,
        info: <Info className="h-5 w-5 text-blue-500" />,
      }}
      {...props}
    />
  );
};

export { Toaster };
```

### Step 5: Update Toast Calls (Optional)

If default icons don't work, update individual toast calls:

```typescript
// Example toast calls with icons
import { toast } from "sonner";
import { CheckCircle, XCircle } from "lucide-react";

// Success toast
toast.success("¡Pedido enviado!", {
  description: "Tu proveedor ha sido notificado",
});

// Error toast
toast.error("Error al enviar", {
  description: "Por favor, intenta nuevamente",
});

// Custom toast with icon
toast("Procesando...", {
  icon: <Loader2 className="h-5 w-5 animate-spin text-blue-500" />,
});
```

### Step 6: Verify Rating Dialog Font

```tsx
// src/components/consumer/rating-dialog.tsx (or similar)

import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";

export function RatingDialog({ open, onOpenChange, ... }) {
  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="font-sans">
        {/* font-sans ensures Inter font from Tailwind config */}
        <DialogHeader>
          <DialogTitle className="font-semibold">
            ¿Cómo fue tu experiencia?
          </DialogTitle>
        </DialogHeader>

        {/* Star rating selector */}
        <div className="flex justify-center gap-2 py-4">
          {/* Stars */}
        </div>

        {/* Comment field */}
        <textarea
          className="w-full border rounded-lg p-3 text-sm font-sans"
          placeholder="Cuéntanos más..."
        />

        {/* Submit button */}
        <Button className="w-full font-medium">
          Enviar Calificación
        </Button>
      </DialogContent>
    </Dialog>
  );
}
```

### Step 7: Tailwind Font Configuration

Verify Inter font is properly configured:

```typescript
// tailwind.config.ts

const config: Config = {
  theme: {
    extend: {
      fontFamily: {
        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
      },
    },
  },
};
```

And ensure the font is loaded:

```tsx
// src/app/layout.tsx

import { Inter } from "next/font/google";

const inter = Inter({ subsets: ["latin"] });

export default function RootLayout({ children }) {
  return (
    <html lang="es" className={inter.className}>
      <body>{children}</body>
    </html>
  );
}
```

## Testing Checklist

### Manual Testing

- [ ] **Test 1: Status Bar Icon (Android)**
  1. Install PWA on Android device
  2. Trigger a push notification
  3. Observe status bar (top of screen)
  4. Verify: NitoAgua icon visible (not grey circle)

- [ ] **Test 2: Notification Shade Icon**
  1. Pull down notification shade
  2. View the notification
  3. Verify: Full color icon displayed
  4. Verify: Icon is crisp and properly sized

- [ ] **Test 3: Toast Font**
  1. Trigger a toast notification (e.g., submit request)
  2. Compare font to rest of app
  3. Verify: Same font (Inter)
  4. Verify: Consistent weight and size

- [ ] **Test 4: Toast Success Icon**
  1. Trigger a success action
  2. Verify: Green checkmark icon visible
  3. Verify: Icon aligned with text

- [ ] **Test 5: Toast Error Icon**
  1. Trigger an error (e.g., network fail)
  2. Verify: Red X or warning icon visible
  3. Verify: Icon clearly indicates error

- [ ] **Test 6: Rating Dialog Font**
  1. Complete a delivery
  2. View rating popup
  3. Verify: Font matches rest of app
  4. Verify: No jarring differences

## Definition of Done

- [ ] Badge icon created (72x72 monochrome)
- [ ] Service worker uses badge property
- [ ] Manifest has all required icons
- [ ] Sonner configured with Inter font
- [ ] Toast icons display correctly
- [ ] Rating dialog uses consistent font
- [ ] All acceptance criteria pass
- [ ] No TypeScript errors

## Assets Required

| Asset | Size | Purpose |
|-------|------|---------|
| `badge-72.png` | 72x72 | Android status bar (monochrome) |
| `icon-192.png` | 192x192 | Notification shade (color) |
| All manifest icons | Various | PWA installation |

## Notes

These are low-priority polish items that enhance the professional feel of the app but don't affect core functionality. They can be completed after security and core fixes.
