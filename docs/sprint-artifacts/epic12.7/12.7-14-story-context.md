# Story 12.7-14: UI Polish & PWA Fixes - Story Context

## Technical Analysis

### Bugs Addressed

1. **BUG-004:** Offer success toast poor contrast
2. **BUG-018:** Push notification icon blank
3. **BUG-019:** Request submit flash to Step 1

### BUG-004: Toast Contrast

**File:** `src/components/ui/sonner.tsx`

**Issue:** Success toast has low contrast (green on green or similar)

**Fix:**
```tsx
// Ensure success variant has good contrast
<Toaster
  toastOptions={{
    classNames: {
      success: 'bg-green-600 text-white border-green-700',
      error: 'bg-red-600 text-white border-red-700',
      // etc.
    }
  }}
/>
```

### BUG-018: Push Icon Blank

**Files:**
- `public/sw.js` - Service worker
- `src/app/manifest.ts` - PWA manifest

**Issue:** Notification icon not specified or file missing

**Fix in sw.js:**
```javascript
self.addEventListener('push', function(event) {
  const data = event.data?.json() || {};

  const options = {
    body: data.body,
    icon: '/icons/icon-192.png',  // Add this line
    badge: '/icons/badge-72.png', // Optional badge icon
    // ...
  };

  event.waitUntil(
    self.registration.showNotification(data.title, options)
  );
});
```

**Verify icons exist:**
- `/public/icons/icon-192.png`
- `/public/icons/icon-512.png`

### BUG-019: Request Submit Flash

**Files:**
- `src/components/consumer/request-form.tsx`
- `src/app/(consumer)/request/page.tsx`

**Issue:** Form state resets before navigation, causing flash to Step 1

**Fix Options:**

1. **Navigate before reset:**
```tsx
const handleSubmit = async () => {
  setIsSubmitting(true);
  const result = await submitRequest(formData);

  if (result.success) {
    // Navigate FIRST
    router.push(`/request/${result.requestId}`);
    // Don't reset form - component unmounts anyway
  } else {
    setIsSubmitting(false);
    // Handle error
  }
};
```

2. **Full-screen loading overlay:**
```tsx
{isSubmitting && (
  <div className="fixed inset-0 bg-white z-50 flex items-center justify-center">
    <Loader2 className="animate-spin" />
    <p>Enviando solicitud...</p>
  </div>
)}
```

### Files to Modify

| File | Bug | Change |
|------|-----|--------|
| `src/components/ui/sonner.tsx` | BUG-004 | Fix toast contrast |
| `public/sw.js` | BUG-018 | Add icon to notifications |
| `src/components/consumer/request-form.tsx` | BUG-019 | Fix submit flow |

### Testing Checklist

- [ ] Toast has WCAG AA contrast (4.5:1)
- [ ] Notification icon visible on Android
- [ ] No flash on request submit
- [ ] Request navigates smoothly to tracking

### Acceptance Criteria Mapping

| AC | Bug | Implementation |
|----|-----|----------------|
| AC12.7.14.1 | BUG-004 | Toast readable |
| AC12.7.14.2 | BUG-018 | Icon in notification |
| AC12.7.14.3 | BUG-019 | Smooth submit transition |
