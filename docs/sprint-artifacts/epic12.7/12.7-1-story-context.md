# Story 12.7-1: Fix Map Tile Rendering - Story Context

## Technical Analysis

### Current Implementation

**Primary File:** `src/components/consumer/location-pinpoint.tsx`

The map component uses:
- `react-leaflet` with `MapContainer`, `TileLayer`, `Marker`, `useMapEvents`
- OpenStreetMap tile layer: `https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`
- CSS import: `import "leaflet/dist/leaflet.css"`
- Error handling with 10-second timeout
- Graceful degradation UI when map fails to load

### Root Cause Investigation

The map component appears well-implemented. Potential issues:

1. **CSS Not Loading** - The Leaflet CSS might not be bundled correctly in production
2. **Tile Layer CORS** - OpenStreetMap tiles might be blocked
3. **Container Sizing** - `min-h-[300px]` might not be sufficient
4. **SSR Issues** - Leaflet doesn't work server-side, need dynamic import

### Key Code Sections

```typescript
// Line 8: CSS import
import "leaflet/dist/leaflet.css";

// Lines 184-208: Map container
<MapContainer
  center={position}
  zoom={DEFAULT_ZOOM}
  className="h-full w-full"
  whenReady={() => setMapLoaded(true)}
>
  <TileLayer
    url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
    eventHandlers={{
      tileerror: () => setMapError(true)
    }}
  />
</MapContainer>
```

### Testing Approach

1. Check browser console for tile errors during testing
2. Verify CSS is loading (map container should have proper styling)
3. Test on Android PWA specifically (where bug was reported)
4. Check network tab for blocked requests

### Files to Modify

| File | Change |
|------|--------|
| `src/components/consumer/location-pinpoint.tsx` | Fix tile loading issue |
| `src/components/consumer/location-pinpoint-wrapper.tsx` | May need dynamic import |
| `next.config.js` | May need Leaflet transpile config |

### Acceptance Criteria Mapping

| AC | Implementation |
|----|----------------|
| AC12.7.1.1 | Map tiles render on all browsers |
| AC12.7.1.2 | Graceful fallback if tiles fail |
| AC12.7.1.3 | Works on Android PWA |
